<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba WaveSurfer + FLAC</title>
    <script src="https://unpkg.com/wavesurfer.js@7.7.5"></script>
    <style>
        body { 
            background-color: #121212; 
            color: #fff; 
            font-family: sans-serif; 
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        h1 { color: #1DB954; }
        #waveform { 
            border: 1px solid #333; 
            height: 128px; 
            margin-bottom: 10px;
            background-color: #1e1e1e;
        }
        button { 
            padding: 12px 24px; 
            font-size: 1em;
            background-color: #1DB954;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: opacity 0.2s;
            margin: 5px;
        }
        button:hover:not(:disabled) { opacity: 0.8; }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
            opacity: 0.5;
        }
        #status { 
            margin-top: 10px; 
            color: #aaa;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .url-list {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .url-item {
            padding: 8px;
            margin: 5px 0;
            background-color: #2a2a2a;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.85em;
        }
        .url-item.trying { border-left: 3px solid #FFA500; }
        .url-item.success { border-left: 3px solid #1DB954; }
        .url-item.failed { border-left: 3px solid #FF4444; }
    </style>
</head>
<body>
    <h1>üéµ Prueba WaveSurfer + FLAC (Multi-URL)</h1>
    <div id="waveform"></div>
    <div>
        <button id="playPauseBtn" disabled>‚è≥ Esperando...</button>
        <button id="testAllBtn">üîÑ Probar todas las URLs</button>
    </div>
    <div id="status">Listo para probar...</div>
    
    <div class="url-list" id="urlList">
        <strong>URLs a probar:</strong>
        <div id="urlItems"></div>
    </div>

    <script>
        const playPauseBtn = document.getElementById('playPauseBtn');
        const testAllBtn = document.getElementById('testAllBtn');
        const statusDiv = document.getElementById('status');
        const urlItemsDiv = document.getElementById('urlItems');
        
        let wavesurfer = null;
        let currentUrlIndex = 0;

        // Lista de todas las posibles URLs a probar
        const audioUrls = [
            {
                name: "GitHub Pages - Espacios normales",
                url: "https://vloitz.github.io/wav-sets/audio/Jungle Rhythmic Grooves 004.flac"
            },
            {
                name: "GitHub Pages - Espacios codificados (%20)",
                url: "https://vloitz.github.io/wav-sets/audio/Jungle%20Rhythmic%20Grooves%20004.flac"
            },
            {
                name: "GitHub Pages - Espacios con +",
                url: "https://vloitz.github.io/wav-sets/audio/Jungle+Rhythmic+Grooves+004.flac"
            },
            {
                name: "GitHub Raw (main branch)",
                url: "https://raw.githubusercontent.com/vloitz/wav-sets/main/audio/Jungle Rhythmic Grooves 004.flac"
            },
            {
                name: "GitHub Raw - Espacios codificados",
                url: "https://raw.githubusercontent.com/vloitz/wav-sets/main/audio/Jungle%20Rhythmic%20Grooves%20004.flac"
            }
        ];

        // Mostrar lista de URLs
        function displayUrls() {
            urlItemsDiv.innerHTML = '';
            audioUrls.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'url-item';
                div.id = `url-${index}`;
                div.innerHTML = `<strong>${index + 1}.</strong> ${item.name}<br><small>${item.url}</small>`;
                urlItemsDiv.appendChild(div);
            });
        }

        // Inicializar WaveSurfer
        function initWaveSurfer() {
            if (wavesurfer) {
                wavesurfer.destroy();
            }

            wavesurfer = WaveSurfer.create({
                container: '#waveform',
                waveColor: '#555',
                progressColor: '#1DB954',
                height: 128,
                cursorWidth: 2,
                cursorColor: '#fff',
                barWidth: 3,
                barGap: 2,
                responsive: true,
                normalize: true
            });

            wavesurfer.on('loading', (percent) => {
                statusDiv.textContent = `‚è≥ Cargando forma de onda: ${percent}%`;
            });

            wavesurfer.on('ready', () => {
                const duration = wavesurfer.getDuration();
                const minutes = Math.floor(duration / 60);
                const seconds = Math.floor(duration % 60);
                statusDiv.textContent = `‚úÖ ¬°√âxito! Audio listo. Duraci√≥n: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                playPauseBtn.textContent = '‚ñ∂Ô∏è Play';
                playPauseBtn.disabled = false;
                
                // Marcar URL exitosa
                document.getElementById(`url-${currentUrlIndex}`).classList.add('success');
                
                console.log(`‚úÖ URL exitosa: ${audioUrls[currentUrlIndex].url}`);
            });

            wavesurfer.on('error', (err) => {
                console.error(`‚ùå Fall√≥ URL ${currentUrlIndex + 1}:`, err);
                document.getElementById(`url-${currentUrlIndex}`).classList.add('failed');
                
                // Intentar siguiente URL
                currentUrlIndex++;
                if (currentUrlIndex < audioUrls.length) {
                    tryNextUrl();
                } else {
                    statusDiv.textContent = `‚ùå Ninguna URL funcion√≥. Verifica que el archivo est√© subido correctamente.`;
                    playPauseBtn.textContent = '‚ùå Error';
                    playPauseBtn.disabled = true;
                }
            });

            wavesurfer.on('play', () => { playPauseBtn.textContent = '‚è∏Ô∏è Pause'; });
            wavesurfer.on('pause', () => { playPauseBtn.textContent = '‚ñ∂Ô∏è Play'; });
            wavesurfer.on('finish', () => { 
                playPauseBtn.textContent = '‚ñ∂Ô∏è Play';
                statusDiv.textContent = '‚úÖ Reproducci√≥n finalizada';
            });
        }

        // Probar siguiente URL
        function tryNextUrl() {
            if (currentUrlIndex >= audioUrls.length) {
                statusDiv.textContent = '‚ùå No hay m√°s URLs para probar';
                return;
            }

            const currentUrl = audioUrls[currentUrlIndex];
            statusDiv.textContent = `üîç Probando URL ${currentUrlIndex + 1}/${audioUrls.length}: ${currentUrl.name}`;
            
            // Marcar URL actual
            document.getElementById(`url-${currentUrlIndex}`).classList.add('trying');
            
            console.log(`Intentando cargar: ${currentUrl.url}`);
            
            initWaveSurfer();
            wavesurfer.load(currentUrl.url);
        }

        // Bot√≥n para probar todas las URLs
        testAllBtn.addEventListener('click', () => {
            currentUrlIndex = 0;
            
            // Resetear estilos
            document.querySelectorAll('.url-item').forEach(item => {
                item.classList.remove('trying', 'success', 'failed');
            });
            
            playPauseBtn.disabled = true;
            playPauseBtn.textContent = '‚è≥ Probando...';
            
            tryNextUrl();
        });

        // Bot√≥n play/pause
        playPauseBtn.addEventListener('click', () => {
            if (wavesurfer) {
                wavesurfer.playPause();
            }
        });

        // Mostrar URLs al cargar
        displayUrls();

        // Iniciar autom√°ticamente al cargar la p√°gina
        setTimeout(() => {
            testAllBtn.click();
        }, 500);
    </script>
</body>
</html>
